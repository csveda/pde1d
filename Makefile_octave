CC=mkoctfile -mex
CXX=mkoctfile -mex

ifndef REL
  REL=4.2.0
	#REL=4.0.0
endif

ifeq ($(findstring Windows, $(OS)),Windows)
  WIN64=true
	EIGEN=$(HOME)/src/Eigen/eigen-3.3
	BOOST_ROOT=C:/boost/boost_1_57_0
	OCTAVE_ROOT=c:/Octave/Octave-$(REL)
	OCTAVE_INC=$(OCTAVE_ROOT)/include/octave-$(REL)/octave
	SUNDIALS_ROOT=$(HOME)/src/sundials-2.6.2/
	SUNDIALS_INC=-I$(SUNDIALS_ROOT)/include -I./ -Ic:/wgreene/tests/c++/sundialsExamples/pde1dmex_mingw
	LIB_OCT=-L$(OCTAVE_ROOT)/lib/octave/$(REL) -loctave.dll -loctinterp.dll
	ifdef WIN64
	  SUITESPARSE_LIB_DIR = $(HOME)/src/sparse_solvers/SuiteSparse/libs/mingw64
		SUNDIALS_LDIR=$(SUNDIALS_ROOT)/mingw64
	else
	  SUITESPARSE_LIB_DIR = $(HOME)/src/sparse_solvers/SuiteSparse/libs/mingw32
		SUNDIALS_LDIR=$(SUNDIALS_ROOT)/mingw32
	endif
	SUITESPARSE_LIBS=-L$(SUITESPARSE_LIB_DIR) \
	                -lklu -lamd -lcolamd -lbtf -lsuitesparseconfig
else
    UNAME_S := $(shell uname -s)
		ifeq ($(UNAME_S),Linux)
		  EIGEN=$(HOME)/src/Eigen/eigen-3.2.2
      OCTAVE_ROOT=/opt/octave-4.0.0
      OCTAVE_INC=$(OCTAVE_ROOT)/include/octave-4.0.2/octave
      #SUNDIALS_ROOT=/usr/local/include/sundials
      #SUNDIALS_LDIR=/usr/local/lib
      #SUNDIALS_INC=-I$(SUNDIALS_ROOT)/include -I./ 
			SUNDIALS_ROOT=$(HOME)/sundials
      SUNDIALS_LDIR=$(SUNDIALS_ROOT)/lib
      SUNDIALS_INC=-I$(SUNDIALS_ROOT)/include
			BOOST_ROOT=/usr/local
	    SUITESPARSE_LIBS= -L/usr/lib/i386-linux-gnu -l:libklu.a -l:libamd.a \
			                  -l:libcolamd.a -l:libbtf.a -lsuitesparseconfig
		endif
		ifeq ($(UNAME_S),Darwin)
		  EIGEN=$(HOME)/src/eigen/eigen-3.2.9
			OCTAVE_ROOT=/Applications/Octave.app/Contents/Resources/usr
			OCTAVE_INC=$(OCTAVE_ROOT)/include/octave-4.0.2/octave
			SUNDIALS_ROOT=$(HOME)/sundials_inst
			SUNDIALS_INC=-I$(SUNDIALS_ROOT)/include
			SUNDIALS_LDIR=$(SUNDIALS_ROOT)/lib
			BOOST_ROOT=/opt/local/include
			SUITESPARSE_LIBS= -lklu -lamd -lcolamd -lbtf -lsuitesparseconfig
		endif
endif

INC=-I$(EIGEN) -I$(OCTAVE_INC) $(SUNDIALS_INC) \
     -Ipde1dlib -IFDJacobian -Iutil -I$(BOOST_ROOT)

CXXFLAGS= -g -O2 -std=gnu++0x -Wno-deprecated-declarations $(INC)

VPATH=./pde1dlib ./pde1dmex ./FDJacobian ./util

LIBS=$(SUNDIALS_LDIR)/libsundials_ida.a $(SUNDIALS_LDIR)/libsundials_nvecserial.a \
     $(LIB_OCT) $(SUITESPARSE_LIBS)

OBJS=pde1dmex.o PDE1dMexInt.o PDE1dImpl.o PDE1dDefn.o PDEInitConditions.o \
     GausLegendreIntRule.o SunVector.o FDJacobian.o FiniteDiffJacobian.o \
		 ShapeFunction.o MexInterface.o PDEMeshMapper.o PDEModel.o PDEElement.o util.o \
		 ShapeFunctionManager.o ShapeFunctionHierarchical.o

pde1d.mex: $(OBJS)
	mkoctfile -mex  $(OBJS) $(LIBS) -o pde1d.mex

clean:
	$(RM) *.o ./pde1dlib/*.o ./pde1dmex/*.o

distclean: clean
	$(RM) pde1d.mex
	
test:
	#echo $(findstring Linux, $(OS))
	echo $(REL)

